name: Build DLL

on:
  push:
  pull_request


jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

          
      - name: Download LFS file directly
        run: |
          echo "Downloading il2cpp-types.h from correct repository..."
          $lfsUrl = "https://github.com/Gktwo/AP-Cheeto-new/raw/main/appdata/il2cpp-types.h"
          echo "Downloading from: $lfsUrl"
          curl -L -o appdata\il2cpp-types.h "$lfsUrl"
          
          $fileSize = (Get-Item appdata\il2cpp-types.h).Length
          echo "Downloaded file size: $fileSize bytes"
          if ($fileSize -lt 1000000) {
            echo "ERROR: Downloaded file is too small!"
            exit 1
          }
          echo "File download successful."

      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v1.3.1

      - name: Build solution
        run: msbuild il2cpp-dll.sln /p:Configuration=Release /p:Platform=x64

      - name: Upload version.dll
        uses: actions/upload-artifact@v4
        with:
          name: version-dll
          path: ./x64/Release/version.dll
